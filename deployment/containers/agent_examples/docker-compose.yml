version: "3.7"

services:
 client:
     image: "public.ecr.aws/keysight/cyperf-agent:latest"
     container_name: ClientAgent
     healthcheck:
       test: ["CMD", "bash", "-c", "cat /appsec/startup_ready"]
       interval: 10s
       timeout: 5s
       retries: 5
     mem_limit: "4g"
     mem_reservation: "2g"
     cpus: "2"
     cpuset: "0-1"
     environment:
         - AGENT_CONTROLLER=44.224.242.39
         - AGENT_TAGS="Dockers-Group=CyPerf-Agent-Client,node-owner=CyPerf"
         # - AGENT_MANAGEMENT_INTERFACE=eth0
         # - AGENT_TEST_INTERFACE=<host interface name>
     cap_add:
         - NET_ADMIN
         - IPC_LOCK
         - NET_RAW
     networks:
       - cyperf-mgmt-net
 server:
     image: "public.ecr.aws/keysight/cyperf-agent:latest"
     container_name: ServerAgent
     healthcheck:
       test: ["CMD", "bash", "-c", "cat /appsec/startup_ready"]
       interval: 10s
       timeout: 5s
       retries: 5
     mem_limit: "4g"
     mem_reservation: "2g"
     cpus: "2"
     cpuset: "2-3"
     environment:
         - AGENT_CONTROLLER=44.224.242.39
         - AGENT_TAGS="Dockers-Group=CyPerf-Agent-Server,node-owner=CyPerf"
         # - AGENT_MANAGEMENT_INTERFACE=eth0
         # - AGENT_TEST_INTERFACE=<host interface name>
     cap_add:
         - NET_ADMIN
         - IPC_LOCK
         - NET_RAW
#     ports:
#         - "80:80"
#         - "443:443"
     networks:
       - cyperf-mgmt-net
networks:
  cyperf-mgmt-net:
    name: cyperf-mgmt-net
    ipam:
      config:
        - subnet: "192.168.0.0/24"
          gateway: "192.168.0.1"

